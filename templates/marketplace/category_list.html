{% extends 'base.html' %}
{% load static %}
{% load i18n_fields %}
{% load i18n %}

{% block extra_css %}
<style>
/* Defining variables that were missing in your original snippet */
:root {
  --booksy-teal: #00a6b2;
  --booksy-dark: #222;
  --booksy-gray: #666;
  --bg-light: #f8f9fa;
}

.navbar {
  padding: 0.75rem 0;
  background: #fff;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.navbar-brand {
  font-family: "Poppins", sans-serif;
  font-weight: 700;
  font-size: 1.75rem;
  color: #000;
}

.nav-link {
  font-weight: 600;
  color: var(--booksy-dark);
  margin-left: 1rem;
  transition: color 0.2s;
}

.nav-link:hover,
.nav-link.show {
  color: var(--booksy-teal);
}

/* --- Avatar & Hover Dropdown Logic --- */
.nav-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #f0f2f5;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--booksy-dark);
  font-size: 1.4rem;
  transition: all 0.2s;
  cursor: pointer;
  border: 2px solid transparent;
}

.nav-avatar:hover,
.dropdown-hover:hover .nav-avatar {
  background-color: #e4e6eb;
  border-color: var(--booksy-teal);
  color: var(--booksy-teal);
}

@media (min-width: 992px) {
  .dropdown-hover { position: relative; }
  .dropdown-hover .dropdown-menu {
    top: 100% !important;
    right: 0 !important;
    left: auto !important;
    margin-top: 10px !important;
    display: none;
  }
  .dropdown-hover:hover .dropdown-menu,
  .dropdown-hover .dropdown-menu.show {
    display: block;
    animation: fadeIn 0.2s ease-in-out;
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* --- Hero Section --- */
.hero-section {
  position: relative;
  background-image:
    linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),
    url("{% static 'images/banner.avif' %}");
  background-size: cover;
  background-position: center;
  height: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  text-align: center;
}

.hero-title {
  font-family: "Poppins", sans-serif;
  font-weight: 700;
  font-size: 3rem;
  margin-bottom: 2rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* --- Search Bar --- */
.search-container {
  background: #fff;
  padding: 8px;
  border-radius: 50px;
  display: flex;
  align-items: center;
  max-width: 800px;
  margin: 0 auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.search-input-group {
  flex: 1;
  padding: 0 20px;
  border-right: 1px solid #eee;
  position: relative;
}

.search-input-group:last-of-type { border-right: none; }

.search-label {
  display: block;
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--booksy-dark);
  margin-bottom: 2px;
  text-align: left;
}

.search-input {
  width: 100%;
  border: none;
  outline: none;
  font-size: 1rem;
  color: var(--booksy-gray);
}

.btn-hero-search {
  background-color: var(--booksy-teal);
  color: #fff;
  font-weight: 700;
  border: none;
  border-radius: 40px;
  padding: 12px 32px;
  transition: background 0.2s;
}

.btn-hero-search:hover {
  background-color: #008c95;
  color: #fff;
}

/* --- Categories --- */
.category-item {
  text-align: center;
  padding: 20px;
  transition: transform 0.2s;
  cursor: pointer;
  color: var(--booksy-dark);
  text-decoration: none;
  display: block;
}

.category-item:hover {
  transform: translateY(-5px);
  color: var(--booksy-teal);
}

.cat-icon-box {
  width: 64px;
  height: 64px;
  margin: 0 auto 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  color: var(--booksy-dark);
  transition: color 0.2s;
}

.cat-title {
  font-weight: 600;
  font-size: 0.95rem;
}

/* --- Promo Sections --- */
.promo-section {
  background-color: var(--bg-light);
  padding: 80px 0;
}

.promo-title {
  font-family: "Poppins", sans-serif;
  font-weight: 700;
  margin-bottom: 1.5rem;
}

.feature-icon {
  font-size: 2.5rem;
  color: var(--booksy-teal);
  margin-bottom: 1rem;
}

/* --- App Banner --- */
.app-banner {
  background: linear-gradient(135deg, #fff 0%, #f0fbfc 100%);
  padding: 80px 0;
}

/* Mobile Tweaks */
@media (max-width: 991px) {
  .navbar-collapse {
    background: white;
    padding: 1rem;
    border-radius: 0 0 10px 10px;
    border-top: 1px solid #eee;
    margin-top: 10px;
  }
  .btn-hero-search { width: 100%; margin-top: 10px; }
}

@media (max-width: 768px) {
  .hero-title { font-size: 2rem; }
  .search-container { flex-direction: column; border-radius: 12px; padding: 15px; }
  .search-input-group { width: 100%; border-right: none; border-bottom: 1px solid #eee; padding: 10px 0; margin-bottom: 10px; }
}
</style>
{% endblock extra_css %}

{% block content %}
<section class="hero-section">
    <div class="container">
        <h1 class="hero-title">
            {% trans "Будьте собой." %}<br>
            {% trans "Записывайтесь к лучшим мастерам." %}
        </h1>
    <form action="{% url 'marketplace:salon_list' %}" method="GET" class="search-container text-start">
        <div class="search-input-group">
            <label class="search-label">{% trans "ЧТО ВЫ ИЩЕТЕ?" %}</label>
            <input type="text" 
                  name="q" 
                  class="search-input" 
                  placeholder="{% trans 'Напр. стрижка, маникюр, спа...' %}"
                  value="{{ search_query|default:'' }}">
        </div>
        
        <div class="search-input-group">
            <label class="search-label">{% trans "ГДЕ?" %}</label>
            <input type="text" 
                  name="location" 
                  class="search-input" 
                  placeholder="{% trans 'Город или адрес' %}"
                  value="{{ search_location|default:'' }}">
        </div>
        
        <button type="submit" class="btn btn-hero-search">{% trans "Найти?" %}</button>
    </form>
    </div>
</section>

<section class="container py-5">
    <div class="row g-4 justify-content-center">
        {% for c in categories %}
            <div class="col-6 col-md-3 col-lg-2">
                <a href="{% url 'marketplace:salon_list_by_category' c.slug %}" class="category-item">
                    <div class="cat-icon-box">
                        <i class="{% if c.icon_class %}{{ c.icon_class }}{% else %}bi bi-grid{% endif %}"></i>
                    </div>
                    <div class="cat-title">{% i18n c "name" %}</div>
                </a>
            </div>
        {% empty %}
            <div class="col-12 col-lg-8">
                <div class="alert alert-warning text-center mb-0">{% trans "No categories yet!" %}</div>
            </div>
        {% endfor %}
    </div>
</section>

<section class="promo-section">
    <div class="container text-center">
        <h2 class="promo-title mb-5">{% trans "Почему ebook?" %}</h2>
        <div class="row g-5">
            <div class="col-md-4">
                <i class="bi bi-search feature-icon"></i>
                <h4 class="fw-bold mb-3">{% trans "Находите" %}</h4>
                <p class="text-muted">{% trans "ebook поможет найти лучших мастеров красоты и здоровья рядом с вами." %}</p>
            </div>
            <div class="col-md-4">
                <i class="bi bi-calendar-check feature-icon"></i>
                <h4 class="fw-bold mb-3">{% trans "Записывайтесь" %}</h4>
                <p class="text-muted">{% trans "Смотрите свободное время в календаре мастера и записывайтесь мгновенно 24/7." %}</p>
            </div>
            <div class="col-md-4">
                <i class="bi bi-bell feature-icon"></i>
                <h4 class="fw-bold mb-3">{% trans "Управляйте" %}</h4>
                <p class="text-muted">{% trans "Переносите визиты и управляйте своим расписанием в приложении." %}</p>
            </div>
        </div>
    </div>
</section>

<section class="py-5" style="background: linear-gradient(145deg, #f8f9fa 0%, #e3f2fd 100%);">
    <div class="container py-md-5">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-5 mb-lg-0 text-center text-lg-start">
                <span class="badge rounded-pill bg-primary bg-opacity-10 text-primary px-3 py-2 mb-3">
                    {% trans "Новинка" %}
                </span>
                <h2 class="display-5 fw-bold mb-3 text-dark">
                    {% trans "Записывайтесь мгновенно через" %} 
                    <span style="color: #24A1DE;">Telegram</span>
                </h2>
                <p class="lead text-muted mb-4">
                    {% trans "Никаких загрузок и обновлений. Запускайте ibron прямо в любимом мессенджере и бронируйте услуги за 10 секунд." %}
                </p>
                
                <div class="d-flex justify-content-center justify-content-lg-start">
                    <a href="https://t.me/ibronuz_bot" 
                       class="btn btn-lg px-4 py-3 shadow-lg d-flex align-items-center" 
                       style="background-color: #24A1DE; color: white; border-radius: 15px; transition: transform 0.2s;">
                        <i class="bi bi-telegram fs-3 me-3"></i>
                        <div class="text-start lh-1">
                            <small class="d-block mb-1" style="font-size: 0.75rem; opacity: 0.8;">{% trans "Открыть в" %}</small>
                            <span class="fw-bold fs-5 text-uppercase">{% trans "Telegram Bot" %}</span>
                        </div>
                    </a>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="position-relative">
                    <img src="{% static 'images/tg_ad.jpeg' %}" 
                         alt="Telegram Bot ibron" 
                         class="img-fluid rounded-5 shadow-2-strong" 
                         style="max-height: 500px; width: 100%; object-fit: cover; border: 8px solid white;">
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const navCollapse = document.querySelector('.navbar-collapse');
        // Check if element exists before initializing
        if(navCollapse) {
            const navLinks = document.querySelectorAll('.nav-link:not(.dropdown-toggle)');
            const bsCollapse = new bootstrap.Collapse(navCollapse, {toggle: false});
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (navCollapse.classList.contains('show')) bsCollapse.hide();
                });
            });
        }
    });
</script>
{% endblock extra_js %}

