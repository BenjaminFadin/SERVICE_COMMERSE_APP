{% extends 'base.html' %}
{% load tz %}
{% load static %}

{% block title %}Dashboard Â· {{ salon.name_ru|default:"Business" }}{% endblock title %}

{% block extra_css %}
<style>
    /* Dashboard specific styling */
    .dashboard-header {
        background: white;
        border-bottom: 1px solid #dee2e6;
        padding: 1.5rem 0;
        margin-bottom: 2rem;
    }
    
    .card-stats {
        border-radius: 12px;
        transition: transform 0.2s;
    }

    .booking-row {
        transition: background 0.1s;
    }

    .booking-row:hover {
        background-color: #f8f9fa;
    }

    .status-badge {
        font-size: 0.75rem;
        padding: 0.35em 0.65em;
        border-radius: 50px;
        font-weight: 600;
    }
    
    /* Custom status colors */
    .status-confirmed { background-color: #e1f5fe; color: #0288d1; }
    .status-pending { background-color: #fff3e0; color: #ef6c00; }
    .status-completed { background-color: #e8f5e9; color: #2e7d32; }

    /* Hide main site footer for a cleaner dashboard feel (Optional) */
    footer { display: none; }
</style>
{% endblock extra_css %}

{% block content %}

{% block navbar %}
{% endblock navbar %}
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom sticky-top shadow-sm mb-4">
  <div class="container">
    <span class="navbar-brand fw-bold text-primary">
        <i class="bi bi-speedometer2 me-2"></i>Business Panel
    </span>
    <div class="ms-auto">
      <a class="btn btn-sm btn-outline-secondary rounded-pill px-3" href="{% url 'marketplace:salon_list' %}">
        <i class="bi bi-eye me-1"></i> Client view
      </a>
    </div>
  </div>
</nav>

<main class="container pb-5">
  {% if not salon %}
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm text-center p-5">
                <i class="bi bi-shop fs-1 text-muted mb-3"></i>
                <h4>No Salon Found</h4>
                <p class="text-muted">You haven't registered a business yet.</p>
            </div>
        </div>
    </div>
  {% else %}
    
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb mb-1">
                                    <li class="breadcrumb-item small text-uppercase">Admin</li>
                                    <li class="breadcrumb-item small text-uppercase active">Dashboard</li>
                                </ol>
                            </nav>
                            <h1 class="h3 mb-1 fw-bold">{{ salon.name_ru }}</h1>
                            <p class="text-muted mb-0 small">
                                <i class="bi bi-geo-alt me-1"></i> {{ salon.address }}
                            </p>
                        </div>
                        <div class="bg-light p-3 rounded-3 text-center">
                            <div class="h4 mb-0 fw-bold text-primary">{{ bookings|length }}</div>
                            <div class="text-muted small text-uppercase" style="font-size: 0.65rem; letter-spacing: 1px;">Today's Bookings</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold">Daily Schedule</h5>
                    <span class="badge bg-soft-primary text-primary">{{ now|date:"d M, Y" }}</span>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4 border-0 small text-muted">CLIENT</th>
                                    <th class="border-0 small text-muted">SERVICE / MASTER</th>
                                    <th class="border-0 small text-muted">TIME</th>
                                    <th class="pe-4 border-0 small text-muted text-end">STATUS</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for b in bookings %}
                                <tr class="booking-row">
                                    <td class="ps-4">
                                        <div class="fw-bold">{{ b.client }}</div>
                                    </td>
                                    <td>
                                        <div class="small">{{ b.service }}</div>
                                        <div class="text-muted small">{{ b.master }}</div>
                                    </td>
                                    <td>
                                        <div class="fw-semibold">{{ b.start_time|localtime|date:"H:i" }}</div>
                                    </td>
                                    <td class="pe-4 text-end">
                                        <span class="status-badge status-confirmed">
                                            {{ b.get_status_display }}
                                        </span>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center py-5 text-muted">
                                        <i class="bi bi-calendar-x d-block fs-2 mb-2"></i>
                                        No bookings scheduled for today.
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mt-4 mt-lg-0">
            <div class="card border-0 shadow-sm bg-primary text-white mb-3">
                <div class="card-body">
                    <h6>Quick Tips</h6>
                    <p class="small opacity-75">Keep your availability updated to receive more bookings from clients.</p>
                    <a href="#" class="btn btn-sm btn-light w-100 fw-bold">Update Calendar</a>
                </div>
            </div>
        </div>
    </div>

  {% endif %}
</main>
{% endblock content %}

{% block extra_js %}
<script>
    // You can add logic here to auto-refresh the bookings every 5 minutes
    console.log("Dashboard loaded for {{ salon.name_ru }}");
</script>
{% endblock extra_js %}